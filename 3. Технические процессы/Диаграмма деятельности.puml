@startuml Activity Diagram

title Интернет-магазин — Activity: Оформление заказа (идеальный вариант)

|Покупатель|
start
:Найти товар (поиск/фильтры);
:Выбрать товар;
:Добавить в корзину;
:Перейти к оформлению;

|Система|
:Проверить наличие и актуальную цену;

if (Товар доступен?) then (да)

    |Покупатель|
    :Ввести данные доставки и контакты;
    :Выбрать способ оплаты;
    :Подтвердить заказ;

    |Система|
    :Валидировать данные заказа;

    while (Данные корректны?) is (нет)
        :Отобразить ошибки ввода;
        |Покупатель|
        :Исправить данные;
        |Система|
        :Валидировать данные заказа;
    endwhile (да)

    :Создать заказ (статус "Создан");
    :Инициировать оплату;

    |Покупатель|
    :Оплатить заказ;

    |Система|
    :Обработать оплату;

    while (Оплата успешна?) is (нет)
        |Система|
        :Сообщить об ошибке оплаты;
        |Покупатель|
        :Попробовать оплатить заказ снова;
        |Система|
        :Обработать оплату;
    endwhile (да)

    fork
        |Покупатель|
        :Получить подтверждение\nи номер заказа;
    fork again
        |Система|
        :Обновить статус заказа на "Оплачен";
        :Сформировать подтверждение заказа;
    fork again
        |Система|
        :Отправить уведомление\nо новом заказе продавцу;
    end fork

    |Система|
    :Закрыть оформление заказа;

else (нет)
    |Система|
    :Сообщить, что товар недоступен;
endif

stop

@enduml
