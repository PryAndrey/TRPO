stateDiagram-v2
    [*] --> Гость

    Гость --> ГлавнаяСтраница : Открыл сайт
    ГлавнаяСтраница --> КаталогТоваров : Нажал "Каталог"
    ГлавнаяСтраница --> Регистрация : Нажал "Регистрация"
    ГлавнаяСтраница --> Авторизация : Нажал "Войти"
    
    %% Аутентификация
    Регистрация --> ПодтверждениеEmail : Заполнил форму
    ПодтверждениеEmail --> Авторизация : Email подтвержден
    Авторизация --> Пользователь : Успешный вход
    
    %% Пользователь
    state Пользователь {
        [*] --> ЛичныйКабинет
        ЛичныйКабинет --> Профиль : Нажал "Профиль"
        ЛичныйКабинет --> ИсторияЗаказов : Нажал "История"
        ЛичныйКабинет --> Корзина : Нажал "Корзина"
        ЛичныйКабинет --> Избранное : Нажал "Избранное"
        
        Профиль --> РедактированиеПрофиля : Нажал "Редактировать"
        РедактированиеПрофиля --> Профиль : Сохранил изменения
    }
    
    %% Навигация по магазину
    ГлавнаяСтраница --> КаталогТоваров : Нажал "Товары"
    КаталогТоваров --> КатегорияТоваров : Выбрал категорию
    КатегорияТоваров --> КарточкаТовара : Выбрал товар
    
    %% Работа с товаром
    КарточкаТовара --> ДобавлениеВКорзину : Нажал "В корзину"
    КарточкаТовара --> ДобавлениеВИзбранное : Нажал "В избранное"
    КарточкаТовара --> КатегорияТоваров : Нажал "Назад"
    
    %% Корзина
    Корзина --> ПросмотрКорзины : Автоматически
    ПросмотрКорзины --> РедактированиеКорзины : Нажал "Изменить"
    РедактированиеКорзины --> ПросмотрКорзины : Сохранил изменения
    ПросмотрКорзины --> ОформлениеЗаказа : Нажал "Оформить"
    
    %% Оформление заказа
    ОформлениеЗаказа --> ВыборДоставки : Заполнил адрес
    ВыборДоставки --> ВыборОплаты : Выбрал способ
    ВыборОплаты --> ПодтверждениеЗаказа : Проверил данные
    ПодтверждениеЗаказа --> ОплатаЗаказа : Нажал "Оплатить"
    
    %% Статусы заказа
    ОплатаЗаказа --> ОжиданиеПодтверждения : Платеж отправлен
    ОжиданиеПодтверждения --> ЗаказПодтвержден : Платеж принят
    ЗаказПодтвержден --> ЗаказСобирается : Магазин начал сборку
    ЗаказСобирается --> ЗаказПереданКурьеру : Готов к отправке
    ЗаказПереданКурьеру --> ЗаказВПути : Курьер забрал
    ЗаказВПути --> ЗаказДоставлен : Получен клиентом
    ЗаказДоставлен --> ОставитьОтзыв : Нажал "Оставить отзыв"
    
    %% Возвраты
    ЗаказДоставлен --> ВозвратТовара : Нажал "Вернуть товар"
    ВозвратТовара --> ЗаявкаНаВозврат : Заполнил форму
    ЗаявкаНаВозврат --> ОжиданиеРешение : Заявка отправлена
    ОжиданиеРешение --> ВозвратОдобрен : Админ одобрил
    ВозвратОдобрен --> ВозвратОплачен : Деньги возвращены
    ОжиданиеРешение --> ВозвратОтклонен : Админ отклонил
    
    %% Администратор
    state Администратор {
        [*] --> АдминПанель
        АдминПанель --> УправлениеТоварами : Нажал "Товары"
        АдминПанель --> УправлениеЗаказами : Нажал "Заказы"
        АдминПанель --> УправлениеПользователями : Нажал "Пользователи"
        
        УправлениеТоварами --> ДобавлениеТовара : Нажал "Добавить"
        УправлениеТоварами --> РедактированиеТовара : Выбрал товар
        УправлениеЗаказами --> ИзменениеСтатусаЗаказа : Выбрал заказ
        УправлениеПользователями --> БлокировкаПользователя : Выбрал пользователя
    }
    
    %% Переходы между ролями
    Пользователь --> Администратор : Вход с правами админа
    Администратор --> Пользователь : Выход из админки
    
    %% Глобальные переходы
    Гость --> Пользователь : Успешная авторизация
    Пользователь --> Гость : Выход из системы
    ГлавнаяСтраница --> [*] : Закрыл сайт